HashKnownHosts no
TCPKeepAlive no
ServerAliveCountMax 15
ServerAliveInterval 60
Compression no
UpdateHostKeys yes

CanonicalizeHostname Yes
CanonicalDomains es.net testbed100.es.net ocean.cu-es.net

ControlMaster auto
ControlPersist yes
ControlPath ~/.ssh/master-%r@%h:%p

Match canonical host *.es.net
  ForwardAgent yes

# We don't need to forward on the gateways
Match canonical host *-gw.es.net
  ProxyJump none

# First, try a direct connection
Match canonical host *.es.net exec "nc -w 1 -z %h 22"
  ProxyJump none
  PasswordAuthentication no
  PKCS11Provider /Library/OpenSC/lib/opensc-pkcs11.so

# If that failed, try using chic-gw
Match canonical host *.es.net exec "nc -w 1 -z chic-gw.es.net 22"
  ProxyJump chic-gw
  ForwardAgent yes
  PasswordAuthentication no
  PKCS11Provider /Library/OpenSC/lib/opensc-pkcs11.so

# If chic-gw failed, try using lbnl-gw
Match canonical host *.es.net exec "nc -w 1 -z lbnl-gw.es.net 22"
  ProxyJump lbnl-gw
  ForwardAgent yes
  PasswordAuthentication no
  PKCS11Provider /Library/OpenSC/lib/opensc-pkcs11.so

Host bro-tb
  Hostname bro-tb.testbed100.es.net
  ForwardAgent yes
  ProxyJump none

Host scan-test
  Hostname scan-test.ocean.cu-es.net
  ForwardAgent yes
  ProxyJump none
  User root

Host panix
  Hostname vc136-90.vc.panix.com
  ProxyJump none

Host personal.github.com
  HostName github.com
  User soehlert
  PreferredAuthentications publickey
  IdentityFile ~/.ssh/id_rsa
  IdentitiesOnly yes
